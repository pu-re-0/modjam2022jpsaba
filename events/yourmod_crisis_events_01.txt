namespace = yourmod_crisis_01
#1 decide first victim country
#2 notification for first victim
#3 hide or dont(trigger start event chain)
#4 informed conscent(start event chain)
#5 uninformed conscent(start event chain)

#100 investigate virus trigger
#101 investigate virus

country_event = { # decide first victim country
	id = yourmod_crisis_01.1
	fire_only_once = yes
	#is_triggered_only = yes
	hide_window = yes

	trigger = {
		has_global_flag = yourmod_in_progress # see mid_game_crisis_trigger_events.txt
		or = {
			any_owned_fleet = { # Any research ship doing excavation
				has_fleet_order = excavate_archaeological_site_fleet_order
			}
			any_owned_planet = {# Has death world or many pops or nojobs
				or = {
					is_planet_class = pc_nuked
					num_pops > 49
					num_unemployed > 4
				}
			}
			
			is_ai = yes # victim
		}
	}

	mean_time_to_happen = {
		years = 5
		modifier = {
			factor = 1.25
			is_ai = yes
		}
		modifier = {
			factor = 0.80
			mid_game_years_passed >= 1
		}

		modifier = {
			factor = 0.75
			mid_game_years_passed >= 2
		}

		modifier = {
			factor = 0.66
			mid_game_years_passed >= 3
		}

		modifier = {
			factor = 0.50
			mid_game_years_passed >= 5
		}

		modifier = {
			factor = 0.25
			mid_game_years_passed >= 7
		}

		modifier = {
			factor = 0.10
			mid_game_years_passed >= 10
		}
	}

	immediate = {
		set_global_flag = yourmod_virus_first_infection
		set_country_flag = yourmod_virus_infected
		save_global_event_target_as = yourmod_virus_first_victim
		random_owned_planet = {
			trigger = {
				is_colony = yes
			}
			save_global_event_target_as = yourmod_virus_first_onset_planet
		}

		country_event = {
			id = yourmod_crisis_01.2 # bad news for first victim
			days = 31
		}
	}
}


country_event = { # notification for first victim
	id = yourmod_crisis_01.2
	title = yourmod_crisis_01.2.name
 	desc = {
 		trigger = {
 			THIS = { is_robot_empire = yes }
 		}
 		text = yourmod_crisis_01.2.robotic.desc
 	}
 	desc = yourmod_crisis_01.2.desc

	#未知の病気を確認
	#最近、[yourmod_virus_first_onset_planet.GetName]において新種の病気が確認されている。感染者は発熱、嘔吐、倦怠感などの症状に襲われ、最悪の場合は死に至るようだ。奇妙なことに、病原体を発見する試みは成功していない。しかし感染は急速に拡大しているようで、[yourmod_virus_first_onset_planet.GetName]の市民はこの奇妙な病気を$yourmod_crisis$と呼んで恐れている。
	#最近、[yourmod_virus_first_onset_planet.GetName]において奇妙な現象の発生が確認されている。ドローンの思考回路に異常が発生し、そのうえで機体内部が徐々に破壊され、最終的にドローンが死に至るという現象だ。この現象に遭遇したドローンはしばしば「不快感」と熱の異常発生を訴えている。さらに、当該のドローンに接触したドローンにもまた同様の現象が起こっているようだ。この現象には、有機生命体の言う感染症と近いものがあり、既に[yourmod_virus_first_onset_planet.GetName]上のかなりの数のドローンが「感染」しているとみられる。以後、本現象は$yourmod_crisis$と呼称する。

	picture = GFX_evt_mining_station
	show_sound = event_ship_bridge # この辺はあとでいい感じの奴にしておく

	is_triggered_only = yes
	location = event_target:yourmod_virus_first_onset_planet

	option = { # Start First Situation
		trigger = { is_robot_empire = no }
		name = yourmod_crisis_01.2.a
		#begin_yourmod_virus_infection_situation = yes
	}

	option = { # Start First Situation
		trigger = { is_robot_empire = yes }
		name = yourmod_crisis_01.2.b
		#begin_yourmod_virus_infection_situation = yes
	}
}


country_event = { # Hide, or don't
	id = yourmod_crisis_01.3
	title = yourmod_crisis_01.3.name
 	desc = {
 		trigger = {
 			THIS = { is_robot_empire = yes }
 		}
 		text = yourmod_crisis_01.3.robotic.desc
 	}
 	desc = yourmod_crisis_01.3.desc

	#隠すべきか知らせるべきかという問題
	#未知の病気が我々を襲っている。これは帝国政府と[yourmod_virus_first_onset_planet.GetName]の住民にとっては周知の事実だ。だが、他の惑星や帝国にとってはそうではない。彼らは皆、今まで通りの日々が続くと信じている。もしかしたら、この問題は[yourmod_virus_first_onset_planet.GetName]に留めて対処することができるかもしれない。新種の感染症の存在を公開して、経済に大混乱が発生するのは容認できない。だが隠蔽して対処に失敗し、しかも他の惑星や帝国にも病気が広がるようなことがあれば、その時は責任問題はおろか、外交問題にさえ発展するかもしれない。
	#未知の病気が我々を襲っている。これは我々全員に周知の事実だ。だが、他の帝国にとってはそうではない。彼らは皆、今まで通りの日々が続くと信じている。もしかしたら、この問題は[yourmod_virus_first_onset_planet.GetName]に留めて対処することができるかもしれない。もし他の帝国に病気の存在を知らせれば、彼らは態度を硬化させ、交易や交流を禁じるようなことがあるかもしれない。だが、隠蔽して他国に感染が広がり、そして病気の起源が我々の惑星にあると知られたら、これはもっと重大な問題になるかもしれない。

	picture = GFX_evt_mining_station
	show_sound = event_ship_bridge # この辺はあとでいい感じの奴にしておく

	is_triggered_only = yes
	location = event_target:yourmod_virus_first_onset_planet

	option = { # Inform Galaxy
		name = yourmod_crisis_01.3.a #隠しておくわけにはいくまい……。
		hidden_effect = {
			every_playable_country = {
				trigger = {
					is_country_type = default
				}
				country_event = {
					id = yourmod_crisis_01.4
					days = 7
					random = 7
				}
			}
		}
	}
	option = { # Hide
		name = yourmod_crisis_01.3.b #我々のメンツが何よりも重要だ。
		hidden_effect = {
			every_playable_country = {
				trigger = {
					is_country_type = default
				}
				country_event = {
					id = yourmod_crisis_01.5
					days = 31
					random = 60
				}
			}
		}
	}
	#隠してもそのうちバレる
}

country_event = { #Informed consent
	id = yourmod_crisis_01.4
	title = yourmod_crisis_01.4.name
 	desc = yourmod_crisis_01.4.desc.a
 	desc = {
 		trigger = {
 			THIS = { is_same_value = FROM }
 		}
 		text = yourmod_crisis_01.4.desc.b
 	}

	picture = GFX_evt_mining_station
	show_sound = event_ship_bridge # この辺はあとでいい感じの奴にしておく

	is_triggered_only = yes

	#[From.GetName]で新種の病気が発見された
	#[From.GetName]からの緊急通信が届いた。かの国によると、彼らの入植地である[yourmod_virus_first_onset_planet.GetName]において新種の感染症が発生し、感染が拡大しているのだという。彼らの科学力を以てしても病原体の特定すらできていないとしていて、[From.GetName]が$yourmod_crisis$と呼称するこの病気に対する警戒と対策をしていく必要があるだろう。
	#我々は全ての銀河勢力に向けて緊急通信を送った。知る限りの情報を伝えた我々に対し、銀河中がよく評価してくれることを祈るばかりだ。

	option = {
		name = yourmod_crisis_01.3.a #これは大変なことになるかもしれない。
		begin_event_chain = { event_chain = yourmod_crisis_chain_1 target = this }
	}
}

country_event = { #Uninformed consent
	id = yourmod_crisis_01.5
	title = yourmod_crisis_01.5.name
 	desc = yourmod_crisis_01.5.desc.a
 	desc = {
 		trigger = {
 			THIS = { is_same_value = FROM }
 		}
 		text = yourmod_crisis_01.5.desc.b
 	}

	picture = GFX_evt_mining_station
	show_sound = event_ship_bridge # この辺はあとでいい感じの奴にしておく

	is_triggered_only = yes

	#[From.GetName]で新種の病気が発見された
	#[From.GetName]の醜聞だ。彼らは[yourmod_virus_first_onset_planet.GetName]で新種の病気が発見されたことを知っていたのに、それを全銀河に対して隠していたのだ。各国が送り込んだ諜報員がいなければ、我々は彼らが$yourmod_crisis$と呼称するこの病気が別の場所で発生した病気と誤認させられていたことだろう。[From.GetName]の悪行はともかくとして、この新興感染症に対する備えをしなければならない。
	#まずいことになった。我々が$yourmod_crisis$を隠蔽していた事実が全銀河に対して明らかになってしまった。我々は情報収集の遅れがあったとして釈明したが、他の帝国はまず信用しないだろう……。

	option = {
		name = yourmod_crisis_01.5.a #これは大変なことになるかもしれない。
		begin_event_chain = { event_chain = yourmod_crisis_chain_1 target = this }
	}
}


##############Investigate Virus

country_event = { # investigate trigger
	id = yourmod_crisis_01.100
	fire_only_once = yes
	#is_triggered_only = yes
	hide_window = yes

	trigger = {
		has_global_flag = yourmod_in_progress # see mid_game_crisis_trigger_events.txt
		#各国の状況が深刻化していることを判定するトリガーを後で入れておく
	}

	mean_time_to_happen = {
		years = 3
	}

	immediate = {
		every_playable_country = {
			trigger = { is_country_type = default }
			country_event = {
				id = yourmod_crisis_01.101
				days = 14
			}
		}
	}
}

country_event = { # Start Investigation
	id = yourmod_crisis_01.101
	title = yourmod_crisis_01.101.name
 	desc = yourmod_crisis_01.101.desc

	#$yourmod_crisis$の調査
	#$yourmod_crisis$が猛威を振るい始めてからある程度時間が経過した。対策や調査に資源を投げ打ってはいるが、それでもまだ病原体の検出にさえ成功していない。有効な治療法も見つかっておらず、このままでは埒が明かない。ここで一回、帝国の総力を挙げて病原体の正体を突き止めるためのプロジェクトを実行するべきだ。例えプロジェクトを遂行する過程でいかなる犠牲や代償を払おうとも、このまま$yourmod_crisis$を放置するよりは遥かに安上がりだ。
	
	picture = GFX_evt_mining_station
	show_sound = event_ship_bridge # この辺はあとでいい感じの奴にしておく
	is_triggered_only = yes

	option = { # Start First Situation
		name = yourmod_crisis_01.101.a
		start_situation = { type = yourmod_crisis_research_situation target = this }
	}
}

##############################Ground Zero Emerging

country_event = { #Situation has done, Ground Zero Emerging, Create Notification
	id = yourmod_crisis_01.300
	title = yourmod_crisis_01.300.name
 	desc = yourmod_crisis_01.300.desc
	fire_only_once = yes
	is_triggered_only = yes

	# $yourmod_crisis$の正体を探るプロジェクトは、その正体をつかむところまではうまくいかなかったが、重要な知見を得ることができた。$yourmod_crisis$の病原体は、有機・無機問わず生命体を貪り、自己複製を行う何かだったのだ。グレイ・グーを引き起こす拙劣なナノマシンとの類似も指摘されたが、悪質なことにそれだけではなかった。病原体は電波を送受信する能力だけではなく、超能力を行使する能力まで持ち合わせていたのだ。ただ物質的に増殖するだけでなく、電波などの媒体を駆使して自らの情報を送信し、何もないところに発生するといった概念的な領域にまで到達している。自らの存在を隠蔽する性質もあり、検出には特殊な手段を要したが、これでいくらか未知のものへ対する恐怖を和らぐことだろう。\nそしてもう一つ重要な事がある。$yourmod_crisis$の病原体は、この銀河のある一つの場所に向かって電波やテレパシーウェーブを送信しているということだ。おそらくはそこに元凶となるものがあるのだろう。直ちにその場所へと急行し、何があるか突き止めなければならない。

	immediate = {
		set_global_flag = yourmod_crisis_ground_zero_entered
		no_scope = {
			set_spawn_system_batch = begin
			spawn_system = {
				#min_jumps = 1
				#max_jumps = 3
				min_distance = 25
				max_distance = 35
				initializer = yourmod_crisis_ground_zero_initializer
				hyperlane = yes
				is_discovered = no
			}
			set_spawn_system_batch = end
		}
	}

	option = { # gotcha!
		name = yourmod_crisis_01.300.a
	}
}



