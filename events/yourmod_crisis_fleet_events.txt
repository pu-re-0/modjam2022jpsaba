namespace = yourmod_crisis_fleet

#################################################################
#test用イベント
namespace = yourmod_test

country_event = {
	id = yourmod_test.01
	fire_only_once = yes
	is_triggered_only = yes

	immediate = {
		set_global_flag = yourmod_crisis_ground_zero_entered
	}

	option = {
		name = yourmod_test.1.a
		set_global_flag = yourmod_crisis_phase_2
		set_country_flag = yourmod_infected_country
	}
	option = {
		name = yourmod_test.1.b
		set_global_flag = yourmod_crisis_phase_2
		set_country_flag = yourmod_health_lost_country
	}
}

##################################################################

country_event = {
	id = yourmod_crisis_fleet.01
	trigger = {
		has_global_flag = yourmod_crisis_phase_2	#enteredの方だと艦隊初登場前に出てきてスト―リーにやや合わないので改変しました by爆雷

	}
	mean_time_to_happen = {
		days = 2
	}
	hide_window = yes
	fire_only_once = yes

	immediate = {
		every_country = {
			if = {
				limit = {
					has_country_flag = yourmod_virus_infected
				}
				set_variable = {
					which = virus_fleet_attack
					value = 50
				}
				set_country_flag = virus_awakened_fleet
			}
			country_event = {
				id = yourmod_crisis_fleet.02
				days = 1
			}
		}
	}
}

###仮
country_event = {
	id = yourmod_crisis_fleet.02
	title = yourmod_crisis_fleet.02.t
	fire_only_once = yes
	is_triggered_only = yes

	trigger = {
		has_global_flag = yourmod_crisis_phase_2
	}

	immediate = { #動くもので上書きしました by爆雷
		every_galaxy_planet = {
			limit = {
				owner = {
					OR = {
						has_country_flag = yourmod_infected_country
						has_country_flag = yourmod_health_lost_country
					}
				}
			}
			save_event_target_as = yourmod_fleet_spawn_planet_1
		}
		event_target:yourmod_crisis_country = {
			while = {
				limit = {
					event_target:yourmod_fleet_spawn_planet_1 = {
						not = { has_planet_flag = yourmod_crisis_fleet_spawned_1 }
					}
				}
				event_target:yourmod_fleet_spawn_planet_1 = {
					set_planet_flag = yourmod_crisis_fleet_spawned_1
				}
				create_fleet = {
             			       name = "NAME_Medium_Virus_fleet"
					settings = {
						garrison = yes
						spawn_debris = no
					}
					effect = {
						set_owner = event_target:yourmod_crisis_country
						#set_fleet_bombardment_stance = armageddon #エラーを吐くのでコメントアウト
						while = {
							count = 10
							create_ship = {
								name = random
								design = "NAME_medium_virus"
								graphical_culture = event_target:yourmod_crisis_country
							}
						}
						set_location = {
							target = event_target:yourmod_fleet_spawn_planet_1
							distance = 1
							angle = random
						}
					}
				}
			}
		}
	}
	option = {
		name = yourmod_crisis_fleet.02.a
	}
}

#感染した惑星の上に艦隊を出現させたいけれどこれで動くかわからない
